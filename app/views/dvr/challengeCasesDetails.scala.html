@*
 * Copyright 2021 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import models.dvr.cases.check.projection.CaseDetails
@import utils.Formatters._
@import config.ApplicationConfig

@import java.time.LocalDateTime
@import java.time.LocalDate

@(authorisationId: Long, challengeCases: List[CaseDetails], isOwner: Boolean, submissionId: String)(govukTable: GovukTable)(implicit messages: Messages, config: ApplicationConfig)

@challengeCaseDetailsUrl(challengeCaseRef: String) = @{
    config.businessRatesChallengeUrl(s"summary/property-link/$authorisationId/submission-id/$submissionId/challenge-cases/$challengeCaseRef?isAgent=${!isOwner}&isDvr=true")
}

@row(submittedDate: LocalDateTime, status: String, challengeReference: String, closedDate: Option[LocalDate], clientOrAgent: String, submittedBy: String) = @{
    Seq(
        TableRow(
            content = Text(formatDateTimeToDate(submittedDate))
        ),
        TableRow(
            content = Text(status.toLowerCase.capitalize.replaceAll("_", " "))
        ),
        TableRow(
            content = HtmlContent(s"<a class='govuk-link' href='${challengeCaseDetailsUrl(challengeReference)}'>$challengeReference</a>")
        ),
        TableRow(
            content = Text(closedDate.fold("")(formatDate(_)))
        ),
        TableRow(
            content = Text(clientOrAgent),
            classes = "break-word"
        ),
        TableRow(
            content = Text(submittedBy),
            classes = "break-word"
        )
    )
}

@rows = @{
    challengeCases.map{ caseDetails =>
        row(caseDetails.submittedDate, caseDetails.status, caseDetails.caseReference, caseDetails.closedDate, caseDetails.clientOrAgent, caseDetails.submittedBy)
    }
}


<h2 class="govuk-heading-l">@messages("property.details.div.submitted.challenge.cases")</h2>

@govukTable(Table(
    rows = rows,
    head = Some(Seq(
      HeadCell(
        content = Text(messages("property.details.cases.table.1"))
      ),
      HeadCell(
        content = Text(messages("property.details.cases.table.3"))
      ),
      HeadCell(
        content = Text(messages("property.details.cases.table.4"))
      ),
      HeadCell(
        content = Text(messages("property.details.cases.table.5"))
      ),
      HeadCell(
        content = Text(messages(s"property.details.cases.table.${if(isOwner) "6" else "7"}"))
      ),
      HeadCell(
        content = Text(messages("property.details.cases.table.8"))
      )
    )),
    attributes = Map("id" -> "checkcases-table")
))
