@*
 * Copyright 2021 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import models.dvr.cases.check.projection.CaseDetails
@import utils.Formatters._
@import config.ApplicationConfig

@import java.time.LocalDateTime
@import java.time.LocalDate

@(authorisationId: Long, challengeCases: List[CaseDetails], isOwner: Boolean, submissionId: String)(implicit messages: Messages, config: ApplicationConfig)

@challengeCaseDetailsUrl(challengeCaseRef: String) = @{
    config.businessRatesChallengeUrl(s"summary/property-link/$authorisationId/submission-id/$submissionId/challenge-cases/$challengeCaseRef?isAgent=${!isOwner}&isDvr=true")
}

@challengeRow(submittedDate: LocalDateTime, status: String, challengeReference: String, closedDate: Option[LocalDate], clientOrAgent: String, submittedBy: String) = {
    <tr class="govuk-table__row">
        <td class="govuk-table__cell">@formatDateTimeToDate(submittedDate)</td>
        <td class="govuk-table__cell">@status.toLowerCase.capitalize.replaceAll("_", " ")</td>
        <td class="govuk-table__cell"><a class="govuk-link" href="@challengeCaseDetailsUrl(challengeReference)">@challengeReference</a></td>
        <td class="govuk-table__cell">@for(d <- closedDate){@formatDate(d)}</td>
        <td class="govuk-table__cell">@clientOrAgent</td>
        <td class="govuk-table__cell">@submittedBy</td>
    </tr>
}


@if(challengeCases.nonEmpty) {
    <h2 class="govuk-heading-l">@messages("property.details.div.submitted.challenge.cases")</h2>

    <div id="details-content-challengecases">
        <table id="challengecases-table" class="govuk-table margin-top-10">
            <thead class="govuk-table__head">
                <tr class="govuk-table__row">
                    <th class="govuk-table__header app-options__limit-table-cell" scope="col">@messages("property.details.cases.table.1")</th>
                    <th class="govuk-table__header app-options__limit-table-cell" scope="col">@messages("property.details.cases.table.3")</th>
                    <th class="govuk-table__header app-options__limit-table-cell" scope="col">@messages("property.details.challenge.cases.table.4")</th>
                    <th class="govuk-table__header app-options__limit-table-cell" scope="col">@messages("property.details.cases.table.5")</th>
                    <th class="govuk-table__header app-options__limit-table-cell" scope="col">
                    @if(isOwner) {
                        @messages("property.details.cases.table.6")
                    }else{
                        @messages("property.details.cases.table.7")
                    }
                    </th>
                    <th class="govuk-table__header app-options__limit-table-cell" scope="col">@messages("property.details.cases.table.8")</th>
                </tr>
            </thead>
            <tbody class="govuk-table__body">
                @for(caseDetails <- challengeCases) {
                    @challengeRow(caseDetails.submittedDate, caseDetails.status, caseDetails.caseReference, caseDetails.closedDate, caseDetails.clientOrAgent, caseDetails.submittedBy)
                }
            </tbody>
        </table>
    </div>
}
