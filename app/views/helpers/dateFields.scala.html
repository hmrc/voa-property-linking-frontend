@*
* Copyright 2021 HM Revenue & Customs
*
*@

@import _root_.utils.Formatters._
@import java.time.LocalDate


@this(govukDateInput: GovukDateInput)

@(
        form: Form[_],
        fieldName: String,
        id: Option[String] = None,
        hintMessageKey: String = "help.date",
        hintDateOverride: Option[LocalDate] = None,
        label: Option[String] = None)(implicit request: Request[_], messages: Messages)

@dateErrors = @{
    form.error(s"$fieldName").map(errors => ErrorMessage(content = Text(messages(errors.messages.head))))
}

@hintMessage = @{
    hintDateOverride.fold(messages(hintMessageKey))(dt => messages("help.date.override", formatDateHint(dt)))
}

<div id="@{id.getOrElse(fieldName)}">
@govukDateInput(DateInput(
    fieldset = Some(Fieldset(
        legend = Some(Legend(
            content = Text(messages(s"${label.getOrElse(fieldName)}")),
            isPageHeading = true,
            classes = "govuk-fieldset__legend--m"
        ))
    )),
    hint = Some(Hint(
        content = HtmlContent(Html(hintMessage))
    )),
    id = s"${id.getOrElse(fieldName)}_dates",
    items = Seq("day", "month", "year").map {
        item =>
            InputItem(
                id = s"${id.getOrElse(fieldName).replace(".", "-")}-$item",
                classes = s"govuk-input--width-${if(item == "year") "4" else "2"} ${if(form.hasErrors) "govuk-input--error"}",
                name =  s"$fieldName.$item",
                label = Some(messages(s"label.date.$item")),
                value = form(s"$fieldName.$item").value
            )
    },
    errorMessage = dateErrors
))

</div>