@*
 * Copyright 2019 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.play.views.html.helpers.form
@import helpers._
@import models.AgentPermission
@import controllers.agentAppointment.AppointAgentVM
@import config.ApplicationConfig

@(model: AppointAgentVM, backLink: Option[String])(implicit request: Request[_], messages: Messages, config: ApplicationConfig)

@main_template(
    title = Messages("propertyRepresentation.appointAgent.title"),
    topBackLink = true,
    bottomBackLink = true,
    backLinkUrl = backLink
) {

    <h1 class="heading-xlarge">
    @messages("propertyRepresentation.appointAgent.title")
    </h1>

    <p class="lede">@messages("propertyRepresentation.appointAgent.associatedAgents.p1")</p>

    <p class="lede">@messages("propertyRepresentation.appointAgent.associatedAgents.p2")</p>


    <div class="notice margin-top-20 margin-bottom-20">
        <i class="icon icon-important">
            <span class="visually-hidden">Warning</span>
        </i>
        <p><strong class="bold-small">@messages("propertyRepresentation.appointAgent.warning")</strong></p>
    </div>

    @includes.errorSummary(model.form)

    @form(agentAppointment.routes.AppointAgentController.submitAppointMultipleProperties()) {
        @formBody
    }

}

@formBody = {
    <fieldset>
        <div id="agentCodeRadioGroup" class="@agentCodeRadioErrClass form-group">
            @if(model.agents.nonEmpty) {

                <div class="table-wrapper-no-pad">
                    <table id="middle-radio-buttons" class="margin-bottom-10 margin-top-10">
                        <tbody>
                            <tr>
                                <th><span class="margin-left-5">@messages("propertyRepresentation.table.title.appoint")</span></th>
                                <th><span class="margin-left-5">@messages("propertyRepresentation.table.title.agentId")</span></th>
                                <th><span class="margin-left-5">@messages("propertyRepresentation.table.title.agentName")</span></th>
                            </tr>

                            @model.agents.zipWithIndex.map { case (agent, index) =>
                                @defining(s"agent-radio-${index + 1}") { radioId: String =>
                                    <tr>
                                        <td>
                                            <div class="table-radio multiple-choice">
                                                <input type="radio" id="@radioId" name="agentCodeRadio"
                                                value="@agent.ref"
                                                    @if(model.form.data.getOrElse("agentCodeRadio", "") == agent.ref.toString && !isNewAgent) {
                                                        checked="checked"
                                                        }>
                                                <label for="@radioId">
                                                    <span class="visually-hidden">
                                                    @messages("propertyRepresentation.table.title.appoint")
                                                    </span>
                                                </label>
                                            </div>
                                        </td>
                                        <td>@agent.ref</td>
                                        <td>@agent.name</td>
                                    </tr>
                                }
                            }
                        </tbody>
                    </table>
                </div>
            }

            <div id="agentCodeGroup" class="@agentCodeErrClass margin-top-20 form-group">
                <div class="margin-left-5">
                    <div class="multiple-choice margin-bottom-20">
                        <input id="new-agent-radio-id" type="radio" value="yes" name="agentCodeRadio"
                        data-toggle-id="new-agent-details"
                            @if(isNewAgent) {
                                checked="checked"
                                }>
                        <label for="new-agent-radio-id">@messages("propertyRepresentation.appointAgent.message.appoint")</label>
                    </div>
                    <div class="panel panel-border-narrow" id="new-agent-details" data-toggle-hidden>

                        <p>@messages("propertyRepresentation.appointAgent.message.1")</p>

                        <details>
                            <summary><span class="summary">@messages("propertyRepresentation.appointAgent.summary.1")</span></summary>
                            <div class="panel-indent">
                            @messages("propertyRepresentation.appointAgent.details.1")
                            </div>
                        </details>

                        <div class="">
                            <label class="form-label-bold" for="agentCode" >
                                <span class="label-span">Agent code</span>
                                @if(model.form.error("agentCode").isDefined) {
                                    <span class="error-message">@messages(model.form.error("agentCode").get.message)</span>
                                }
                            </label>
                            <input type="text" id="agentCodeText"
                                @if(isNewAgent) {
                                    value="@model.form.data.getOrElse("agentCode", "")"
                                }
                            name="agentCode" class="form-control" />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </fieldset>

    <div class="margin-left-5">

        @inputRadioGroup(
            field = model.form("canCheck"),
            options = AgentPermission.options,
            args = Seq(
                '_label -> Messages("label.canCheck"),
                '_labelClass -> "form-label-bold",
                '_legend -> true,
                '_fieldsetClass -> "inline",
                '_detailsQuestion -> Messages("canCheck.summary"),
                '_detailsAnswer -> checkAnswer
            )
        )

        @inputRadioGroup(
            field = model.form("canChallenge"),
            options = AgentPermission.options,
            args = Seq(
                '_label -> Messages("label.canChallenge"),
                '_labelClass -> "form-label-bold",
                '_legend -> true,
                '_fieldsetClass -> "inline",
                '_detailsQuestion -> Messages("canChallenge.summary"),
                '_detailsAnswer -> challengeAnswer
            )
        )

        <p>
            <button type="submit" id="submit-button" class="button">@messages("propertyRepresentation.appointAgent.button")</button>
        </p>

    </div>
}

@agentCodeRadioErrClass = @{
    if(model.form.error("agentCodeRadio").isDefined) "error" else ""
}

@agentCodeErrClass = @{
    if(model.form.error("agentCode").isDefined) "error" else ""
}

@isNewAgent = @{
    model.form.data.getOrElse("agentCodeRadio", "") == "yes" || model.agents.isEmpty
}

@checkAnswer = {
    <p>@messages("propertyRepresentation.appointAgent.check.p1")</p>
    <p>@messages("propertyRepresentation.appointAgent.check.p2")</p>
}

@challengeAnswer = {
    <p>@messages("propertyRepresentation.appointAgent.challenges.p1")</p>
    <p>@messages("propertyRepresentation.appointAgent.challenges.p2")</p>
}

