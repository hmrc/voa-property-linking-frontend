@*
 * Copyright 2023 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import binders.propertylinks._
@import controllers.propertyLinking.routes._
@import config.ApplicationConfig
@import models.upscan._
@import models._
@import views.html.includes.assessmentHeading
@import actions.propertylinking.requests.LinkingSessionRequest
@import helpers._
@import models.EvidenceType
@import models.CapacityType
@import binders.propertylinks.EvidenceChoices.EvidenceChoices

@this(govukButton: GovukButton, govukFileUpload: GovukFileUpload, mainLayout: views.html.mainLayout, formWithCSRF: FormWithCSRF)

@(
        evidenceType: EvidenceType,
        evidenceChoice: EvidenceChoices,
        submissionId: String,
        errors: List[String] = Nil,
        uploadedFiles: Map[String, UploadedFileDetails] = Map()
)(implicit request: LinkingSessionRequest[_], messages: Messages, config: ApplicationConfig)

@title = @{
    (request.ses.clientDetails, evidenceType) match {
        case (Some(_), Lease) => {messages("uploadEvidence.lease.client.title")}
        case (Some(_), License) => {messages("uploadEvidence.license.client.title")}
        case (Some(_), RatesBillType) => {messages("uploadRatesBill.show.client.title")}
        case(Some(_), _) => {messages(s"uploadEvidence.$evidenceType.title")}
        case (None, Lease) => {messages("uploadEvidence.lease.title")}
        case (None, License) => {messages("uploadEvidence.license.title")}
        case (None, RatesBillType) => {messages("uploadRatesBill.show.title")}
        case (None, _) => {messages(s"uploadEvidence.$evidenceType.title")}
    }
}

@backUri = @{
    val propertyRelationship = request.ses.propertyRelationship.map(_.capacity).get
    (evidenceType, propertyRelationship) match {
        case (Lease, Owner | OwnerOccupier) => Some(controllers.propertyLinking.routes.UploadController.show(EvidenceChoices.OTHER).url)
        case (License, Owner | OwnerOccupier) => Some(controllers.propertyLinking.routes.UploadController.show(EvidenceChoices.OTHER).url)
        case (Lease, _) => Some(controllers.propertyLinking.routes.ChooseEvidenceController.show.url)
        case (License, _) => Some(controllers.propertyLinking.routes.ChooseEvidenceController.show.url)
        case (noLeaseOrLicense, Occupier) => Some(controllers.propertyLinking.routes.UploadController.show(EvidenceChoices.OTHER).url)
        case (RatesBillType, _) => Some(controllers.propertyLinking.routes.ChooseEvidenceController.show.url)
        case (_, _) => Some(controllers.propertyLinking.routes.UploadController.show(EvidenceChoices.OTHER).url)
    }
}


@mainLayout(
    pageTitle = title,
    backUri = backUri,
    hasErrors = errors.nonEmpty
) {

    @*    @if(errors.nonEmpty) {*@
    @*        <div class="govuk-error-summary" aria-labelledby="error-summary-heading" role="alert" tabindex="-1" data-module="govuk-error-summary">*@

    @*            <h2 class="govuk-error-summary__title" id="error-summary-heading">@messages("error.summary.title")</h2>*@
    @*            <div class="govuk-error-summary__body">*@
    @*                <ul class="govuk-list govuk-error-summary__list">*@
    @*                @errors.map { error =>*@
    @*                    <li><a href="#newFileButton">@messages(error)</a></li>*@
    @*                }*@
    @*                </ul>*@
    @*            </div>*@
    @*        </div>*@
    @*    }*@
    @*    <div id="errorsList"></div>*@

    @assessmentHeading(request.ses.localAuthorityReference, request.ses.address)

    <form id="fileUploadForm" action="@UploadController.initiate(evidenceChoice)" method="post" enctype="multipart/form-data">
    @govukFileUpload(FileUpload(
        name = "file-upload-1",
        id = "file-input",
        label = Label(
            isPageHeading = true,
            classes = "govuk-label--l govuk-!-margin-bottom-3",
            content = Text(title)
        ),
        hint = Some(Hint(
            content = Text(messages("fileUpload.allowedTypes"))
        ))
    ))
    </form>

    @formWithCSRF(action = UploadController.continue(evidenceChoice)) {
        @govukButton(Button(
            content = Text(messages("label.continue")),
            attributes = Map("id" -> "continue")
        ))
    }
}
