@*
 * Copyright 2018 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import actions.AuthenticatedRequest
@import controllers.agentAppointment.AppointAgentPropertiesVM
@import models.searchApi._

@(model: AppointAgentPropertiesVM)(implicit request: AuthenticatedRequest[_], messages: Messages)

@heading = @{ Messages("propertyRepresentation.appointAgentProperties.title") }

@main_template(
    heading,
    contentHeaderText = Some(heading),
    contentHeaderHidden = true,
    topNavigation = false
) {
    <div class="grid-row">
        <div class="column-whole">
            <h1 class="heading-medium">@Messages("propertyRepresentation.appointAgentProperties.title")</h1>
            <p>@Messages("propertyRepresentation.appointAgentProperties.appointAgent")</p>

            <div class="hide-if-no-js">
                <a href="#" id="par-select-all-top">@Messages("propertyRepresentation.appointAgentProperties.selectDeselect")</a>
            </div>

                <table id="agentPropertiesTable" class="agentProperties dataTable table-font-xsmall no-footer">
                    <colgroup>
                        <col style="width:20%">
                        <col style="width:57%">
                        <col style="width:30%">
                        <col style="width:35%">
                        <col style="width:15%">
                    </colgroup>

                    <thead>
                        <tr role="row">
                            <th>@Messages("propertyRepresentation.appointAgents.table.select")</th>
                            <th>@sortingControl(PropertiesSortField.Address)</th>
                            <th>@sortingControl(PropertiesSortField.LocalAuthorityReference)</th>
                            <th>@sortingControl(PropertiesSortField.AgentName)</th>
                            <th class="sorting_disabled" rowspan="1" colspan="1" aria-label="Actions">@Messages("propertyRepresentation.appointAgents.table.actions")</th>
                        </tr>

                        <form method="GET" action="@agentAppointment.routes.AppointAgentController.selectProperties()">
                            <tr>
                                <th></th>
                                <th>@searchField("address")</th>
                                <th>@searchField("localAuthorityReference")</th>
                                <th>@searchField("agentName")</th>
                                <th>
                            <a href="@agentAppointment.routes.AppointAgentController.selectProperties()" id="clear-search" class="clear">@Messages("manageProperties.table.clear.search")</a>
                                </th>
                            </tr>
                        </form>
                    </thead>

                    <tbody>
                    @model.response.authorisations.zipWithIndex.map { case (authorisation, index) =>
                        @defining(s"checkbox-${index+1}") { checkboxId:String =>
                        <tr>
                            <td><div class="checkbox-table-cell">
                                <label class="block-label selection-button-checkbox" for="@("checkboxId"+(index+1))">
                                    <input id=@("checkboxId"+(index+1)) type="checkbox"  name="linkId" value="@authorisation.authorisationId">
                                    <span class="visually-hidden">Appoint</span></label>
                            </div></td>
                            <td class="">@authorisation.address</td>
                            <td>@authorisation.localAuthorityRef</td>
                            <td>
                                <ul class="list">
                                @if(authorisation.agents.isEmpty) {
                                    <li></li>
                                } else {
                                    @authorisation.agents.get.map { agent =>
                                        <li>@agent.organisationName</li>
                                    }
                                }
                                </ul>
                            </td>
                        }
                    }
                    </tbody>
                </table>

            </div>

        <div class="hide-if-no-js">
            <a href="#" id="par-select-all-top">@Messages("propertyRepresentation.appointAgentProperties.selectDeselect")</a>
        </div>
        </div>
}

@searchField(fieldName: String) = {
    <div class="searchfield">
        <label for="@fieldName" class="visually-hidden">@Messages(s"propertyRepresentation.th.$fieldName")</label>
        <input id="@fieldName" name="@fieldName" class="ss-input">
        <button id="@{fieldName}Button" class="search-submit ss-button">@Messages("propertyRepresentation.search", Messages(s"propertyRepresentation.th.$fieldName"))</button>
    </div>
}


@sortingControl(field: PropertiesSortField) = {
    <div id="sort-by-@field" class="sorting">
        <a href="@agentAppointment.routes.AppointAgentController.selectProperties()">@Messages(s"propertyRepresentation.th.$field")</a>
    </div>
}
