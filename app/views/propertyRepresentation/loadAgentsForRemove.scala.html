@*
 * Copyright 2018 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.play.views.html.helpers.form
@import helpers._
@import models.AgentPermission
@import controllers.agentAppointment.AppointAgentVM
@import config.ApplicationConfig

@(model: AppointAgentVM)(implicit request: Request[_], messages: Messages, config: ApplicationConfig)

@main_template(
    title = Messages("propertyRepresentation.removeAgent.title"),
    topBackLink = true,
    bottomBackLink = true,
    backLinkUrl = Some(routes.Dashboard.manageProperties().url)
) {

    <h1 class="heading-xlarge">
    @Messages("propertyRepresentation.removeAgent.title")
    </h1>

    <p class="lede">@Messages("propertyRepresentation.removeAgent.message.p1")</p>

    <p class="lede">@Messages("propertyRepresentation.removeAgent.message.p2")</p>

    @includes.errorSummary(model.form)

    @form(agentAppointment.routes.AppointAgentController.selectAgentProperties()) {
        @formBody
    }

}

@formBody = {
    <fieldset>
        <div id="agentCodeRadioGroup" class="@agentCodeRadioErrClass form-group">
            @if(model.agents.nonEmpty) {

                <div class="table-wrapper-no-pad">
                    <table id="middle-radio-buttons" class="margin-bottom-10 margin-top-10">
                        <tbody>
                            <tr>
                                <th><span class="margin-left-5">@Messages("propertyRepresentation.table.title.appoint")</span></th>
                                <th><span class="margin-left-5">@Messages("propertyRepresentation.table.title.agentId")</span></th>
                                <th><span class="margin-left-5">@Messages("propertyRepresentation.table.title.agentName")</span></th>
                            </tr>

                            @model.agents.zipWithIndex.map { case (agent, index) =>
                                @defining(s"agent-radio-${index + 1}") { radioId: String =>
                                    <tr>
                                        <td>
                                            <div class="table-radio multiple-choice">
                                                <input type="radio" id="@radioId" name="agentCodeRadio"
                                                value="@agent.ref"
                                                    @if(model.form.data.getOrElse("agentCodeRadio", "") == agent.ref.toString && !isNewAgent) {
                                                        checked="checked"
                                                        }>
                                                <label for="@radioId">
                                                    <span class="visually-hidden">
                                                    @Messages("propertyRepresentation.table.title.appoint")
                                                    </span>
                                                </label>
                                            </div>
                                        </td>
                                        <td>@agent.ref</td>
                                        <td>@agent.name</td>
                                    </tr>
                                }
                            }
                        </tbody>
                    </table>
                </div>
            }

        </div>
    </fieldset>
    <div class="margin-left-5">

        <p>
            <button type="submit" id="submit-button" class="button">@Messages("propertyRepresentation.appointAgent.button")</button>
        </p>

    </div>

}

@agentCodeRadioErrClass = @{
    if(model.form.error("agentCodeRadio").isDefined) "error" else ""
}

@isNewAgent = @{
    model.form.data.getOrElse("agentCodeRadio", "") == "yes" || model.agents.isEmpty
}


